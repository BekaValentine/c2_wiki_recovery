<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <base href="/mount/ultralaser_home/Projects/c2_wiki_recovery/out/">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div class="page">
      <h1>
        <img src="wiki.gif" />
        Substitute Class
      </h1>
      <p>
        Contrary to the old saying, you can fit a square-peg into a round hole. There are a couple ways to do it but they involve cheating.  You can glue a square-peg onto a round-peg and use the round-peg as an adapter, or you can cut a square into the hole.  If you want to cheat incrementally you can treat these two strategies as steps -- do them one after the other.
      </p>
      <p>
        Suppose that you have two unrelated classes: an older one which is used pervasively in your system and a clean new one with a different protocol. You'd like to replace the old one with the new one but you don't want to break the system at any time during the transition.
      </p>
      <p>
        Here is a way to do it:
      </p>
      <ol>
        <li>
           Run your tests
        </li>
        <li>
           Make your old class or one of its ancestors inherit the new class.
        </li>
        <li>
           Run your tests
        </li>
        <li>
           <a href="CollapseHierarchy.html">CollapseHierarchy</a> until your old class disappears.  Start by delegating the methods of the old class to methods on the new class.  When they work, start replacing uses of the old class with uses of the new class.
        </li>
        <li>
           Run your tests
        </li>
      </ol>
      <p>
        This refactoring seems to work well when your old class is a leaf near the 
        top of a hierarchy.  If your old class depends upon a superclass for 
        various features, you will have to verify that you can graft your new class
        between them without breaking anything.  If this looks too hazardous, consider 
        whether replacing the old class is really a good idea; it is probably better 
        to clean it up in place.
      </p>
      <p>
        An alternative would be to introduce the new class as a delegate of the old class, testing as each method is delegated, and then ReplaceDelegationWithInheritance and <a href="CollapseHierarchy.html">CollapseHierarchy</a>.  I like the superclass trick because it forces some issues to the foreground.
      </p>
      <p>
        -- <a href="MichaelFeathers.html">MichaelFeathers</a> 
      </p>
    </div>
  </body>
</html>