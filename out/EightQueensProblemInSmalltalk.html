<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <base href="/mount/ultralaser_home/Projects/c2_wiki_recovery/out/">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div class="page">
      <h1>
        <img src="wiki.gif" />
        Eight Queens Problem In Smalltalk
      </h1>
      <p>
        An implementation of the <a href="EightQueensProblem.html">EightQueensProblem</a> in <a href="SmalltalkLanguage.html">SmalltalkLanguage</a>
      </p>
      <p>
        I've gone for maximum Brownie points in that my solution does:
      </p>
      <ul>
        <li>
           arbitrary board sizes
        </li>
        <li>
           logs the solutions found
        </li>
        <li>
           only counts solutions that are unique through reflection and rotation
        </li>
      </ul>
      <ul>
        <li>
           As a sanity check, if you turn that feature off, do your solution counts agree with those given on the other page?
        </li>
      </ul>
      <ul>
        <li>
           solves 3-D chess boards - well maybe not.
        </li>
      </ul>
      <p>
        you can see
      </p>
      <ul>
        <li>
           sample output
        </li>
        <li>
           the code
        </li>
        <li>
           the test code
        </li>
      </ul>
      <p>
        Quite a lot of the code is to do with only counting solutions that are unique through reflection and rotation. Some of it is a little bit repetitive (see method rotationsAndReflections and its friends), but I can't think of a way of slickening it up.
      </p>
      <p>
        Also, I wrote the code before the tests thinking that with such a simple problem I didn't need to bother. Then when I started writing the tests I saw how foolish I had been. Perhaps I'll learn one day.
      </p>
      <p>
        Like the Ruby version, the code also allows the generation of a solution from a partially completed board.
      </p>
      <p>
        As for performance, I don't make any great claims, but I did manage to count the solutions for the 14*14 board without it taking a ridiculously long time.
      </p>
      <p>
        <a href="StephenHutchinson.html">StephenHutchinson</a>
      </p>
      <hr/>
      <p>
        Sample output
      </p>
      <code>
        (1 to: 16) inject: '' into: [ :string :i | string, i printString, ': ', (Board new: i) solutions size printString, '<br/>
        ']<br/>
      </code>
      <ol>
        <li>
          : 1
        </li>
        <li>
          : 0
        </li>
        <li>
          : 0
        </li>
        <li>
          : 1
        </li>
        <li>
          : 2
        </li>
        <li>
          : 1
        </li>
        <li>
          : 6
        </li>
        <li>
          : 12
        </li>
        <li>
          : 46
        </li>
        <li>
          : 92
        </li>
        <li>
          : 341
        </li>
        <li>
          : 1787
        </li>
        <li>
          : 9233
        </li>
        <li>
          : 45752
        </li>
      </ol>
      <code>
        ((Board new: 8) solutions asSortedCollection: [ :a :b | a hash <= b hash])  inject: '' into: [ :sum :each | sum, '<br/>
        ', each printString] <br/>
      </code>
      <ol>
        <li>
          : |Q|_|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|Q|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|_|Q|
        </li>
        <li>
          : |_|_|_|_|_|Q|_|_|
        </li>
        <li>
          : |_|_|Q|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|Q|_|
        </li>
        <li>
          : |_|Q|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|Q|_|_|_|_|
        </li>
      </ol>
      <ol>
        <li>
          : |Q|_|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|Q|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|_|Q|
        </li>
        <li>
          : |_|_|Q|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|Q|_|
        </li>
        <li>
          : |_|_|_|Q|_|_|_|_|
        </li>
        <li>
          : |_|Q|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|Q|_|_|_|
        </li>
      </ol>
      <ol>
        <li>
          : |_|Q|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|Q|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|Q|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|_|Q|
        </li>
        <li>
          : |_|_|Q|_|_|_|_|_|
        </li>
        <li>
          : |Q|_|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|Q|_|
        </li>
        <li>
          : |_|_|_|_|Q|_|_|_|
        </li>
      </ol>
      <ol>
        <li>
          : |_|Q|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|Q|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|Q|_|
        </li>
        <li>
          : |Q|_|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|Q|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|_|Q|
        </li>
        <li>
          : |_|_|_|_|_|Q|_|_|
        </li>
        <li>
          : |_|_|_|Q|_|_|_|_|
        </li>
      </ol>
      <ol>
        <li>
          : |_|Q|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|Q|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|Q|_|
        </li>
        <li>
          : |_|_|_|Q|_|_|_|_|
        </li>
        <li>
          : |Q|_|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|_|Q|
        </li>
        <li>
          : |_|_|_|_|_|Q|_|_|
        </li>
        <li>
          : |_|_|Q|_|_|_|_|_|
        </li>
      </ol>
      <ol>
        <li>
          : |_|Q|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|Q|_|_|
        </li>
        <li>
          : |Q|_|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|Q|_|
        </li>
        <li>
          : |_|_|_|Q|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|_|Q|
        </li>
        <li>
          : |_|_|Q|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|Q|_|_|_|
        </li>
      </ol>
      <ol>
        <li>
          : |_|Q|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|Q|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|_|Q|
        </li>
        <li>
          : |_|_|Q|_|_|_|_|_|
        </li>
        <li>
          : |Q|_|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|Q|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|Q|_|
        </li>
        <li>
          : |_|_|_|_|Q|_|_|_|
        </li>
      </ol>
      <ol>
        <li>
          : |_|Q|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|Q|_|
        </li>
        <li>
          : |_|_|Q|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|Q|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|_|Q|
        </li>
        <li>
          : |_|_|_|_|Q|_|_|_|
        </li>
        <li>
          : |Q|_|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|Q|_|_|_|_|
        </li>
      </ol>
      <ol>
        <li>
          : |_|Q|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|Q|_|
        </li>
        <li>
          : |_|_|_|_|Q|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|_|Q|
        </li>
        <li>
          : |Q|_|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|Q|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|Q|_|_|
        </li>
        <li>
          : |_|_|Q|_|_|_|_|_|
        </li>
      </ol>
      <ol>
        <li>
          : |_|_|Q|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|Q|_|_|_|
        </li>
        <li>
          : |_|Q|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|_|Q|
        </li>
        <li>
          : |Q|_|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|Q|_|
        </li>
        <li>
          : |_|_|_|Q|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|Q|_|_|
        </li>
      </ol>
      <ol>
        <li>
          : |_|_|Q|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|Q|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|_|Q|
        </li>
        <li>
          : |_|_|_|Q|_|_|_|_|
        </li>
        <li>
          : |Q|_|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|Q|_|
        </li>
        <li>
          : |_|Q|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|Q|_|_|
        </li>
      </ol>
      <ol>
        <li>
          : |_|_|Q|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|Q|_|_|
        </li>
        <li>
          : |_|Q|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|Q|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|_|Q|
        </li>
        <li>
          : |Q|_|_|_|_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|_|_|Q|_|
        </li>
        <li>
          : |_|_|_|Q|_|_|_|_|
        </li>
      </ol>
      <hr/>
      <p>
        The Code
      </p>
      <code>
        Object subclass: #Board<br/>
        instanceVariableNames: 'size queenXcoords '<br/>
        classVariableNames: <em></em><br/>
        poolDictionaries: <em>!</em><br/>
      </code>
      <code>
        !Board class publicMethods !<br/>
      </code>
      <code>
        new: anInteger<br/>
        ^self new initializeWithSize: anInteger! !<br/>
      </code>
      <code>
        !Board publicMethods !<br/>
      </code>
      <code>
        = aBoard<br/>
        self class = aBoard class ifFalse: [^false].<br/>
        ^aBoard hasQueenXcoords: queenXcoords!<br/>
      </code>
      <code>
        addAllQueensAt: aCollection<br/>
        aCollection do: [ :each | self addQueenAt: each]!<br/>
      </code>
      <code>
        addQueenAt: aPoint<br/>
        queenXcoords at: aPoint y put: aPoint x!<br/>
      </code>
      <code>
        cardinalForm<br/>
        ^(self rotationsAndReflections asSortedCollection: [ :a :b | a hash <= b hash]) first!<br/>
      </code>
      <code>
        copy<br/>
        ^(self class new: size)<br/>
        queenXcoords: queenXcoords copy!<br/>
      </code>
      <code>
        hash<br/>
        | result |<br/>
        result := 0.<br/>
        queenXcoords do:<br/>
        [ :y |    result := result * size.<br/>
        y notNil ifTrue: [ result := result + y]].<br/>
        ^result!<br/>
      </code>
      <code>
        hasQueenXcoords: aCollection<br/>
        ^queenXcoords = aCollection!<br/>
      </code>
      <code>
        initializeWithSize: anInteger<br/>
        size := anInteger.<br/>
        queenXcoords :=Array new: size.!<br/>
      </code>
      <code>
        nextUnoccupiedRow<br/>
        queenXcoords doWithIndex: [ :x :y | x isNil ifTrue: [^y]].<br/>
        ^nil!<br/>
      </code>
      <code>
        printCharForPosition: aPoint<br/>
        ^(queenXcoords at: aPoint y) = aPoint x<br/>
        ifTrue: [ $Q]<br/>
        ifFalse: [ $_].!<br/>
      </code>
      <code>
        printOn: aStream<br/>
      </code>
      <ol>
        <li>
           to: size do:
        </li>
      </ol>
      <code>
        [ :y |<br/>
        aStream    nextPutAll: y printString;<br/>
        nextPutAll: ': |'.<br/>
      </code>
      <ol>
        <li>
           to: size do: [ :x | aStream    nextPut: (self printCharForPosition: x@y);
        </li>
      </ol>
      <code>
        nextPut: $| ].<br/>
        aStream cr.]!<br/>
      </code>
      <code>
        queenAt: aPoint threatens: bPoint<br/>
        ^(aPoint x = bPoint x)<br/>
        or: [(aPoint y = bPoint y)<br/>
        or: [(aPoint x - bPoint x) abs = (aPoint y - bPoint y) abs]]!<br/>
      </code>
      <code>
        queenPositions<br/>
        | result |<br/>
        result := OrderedCollection new.<br/>
        queenXcoords doWithIndex: [ :x :y | x notNil ifTrue: [result add: x@y]].<br/>
        ^result!<br/>
      </code>
      <code>
        queenXcoords: aCollection<br/>
        queenXcoords := aCollection!<br/>
      </code>
      <code>
        reflectedInHorizontallAxis: aPoint<br/>
        ^aPoint x @ (size + 1 - aPoint y)!<br/>
      </code>
      <code>
        reflectedInNegativeDiagonal: aPoint<br/>
        ^ (size + 1 - aPoint y) @ (size + 1 - aPoint x)!<br/>
      </code>
      <code>
        reflectedInPositiveDiagonal: aPoint<br/>
        ^aPoint y @ aPoint x!<br/>
      </code>
      <code>
        reflectedInVerticalAxis: aPoint<br/>
        ^(size + 1 - aPoint x) @ aPoint y!<br/>
      </code>
      <code>
        rotated180: aPoint<br/>
        ^(size + 1 - aPoint x) @ (size + 1 - aPoint y)!<br/>
      </code>
      <code>
        rotated270: aPoint<br/>
        ^aPoint y @ (size + 1 - aPoint x)!<br/>
      </code>
      <code>
        rotated90: aPoint<br/>
        ^(size + 1 - aPoint y) @ aPoint x!<br/>
      </code>
      <code>
        rotationsAndReflections<br/>
        ^OrderedCollection new<br/>
        add: self;<br/>
        add: (self transformedUsingBlock: [ :each |self rotated90: each]);<br/>
        add: (self transformedUsingBlock: [ :each |self rotated180: each]);<br/>
        add: (self transformedUsingBlock: [ :each |self rotated270: each]);<br/>
        add: (self transformedUsingBlock: [ :each |self reflectedInHorizontallAxis: each]);<br/>
        add: (self transformedUsingBlock: [ :each |self reflectedInVerticalAxis: each]);<br/>
        add: (self transformedUsingBlock: [ :each |self reflectedInPositiveDiagonal: each]);<br/>
        add: (self transformedUsingBlock: [ :each |self reflectedInNegativeDiagonal: each]);<br/>
        yourself!<br/>
      </code>
      <code>
        solutions<br/>
        self nextUnoccupiedRow isNil ifTrue: [^Set with: self cardinalForm].<br/>
        ^(self unthreatenedSquaresInRow: self nextUnoccupiedRow)<br/>
        inject: Set new<br/>
        into: [ :collection :each | collection<br/>
        addAll: (self copy addQueenAt: each) solutions;<br/>
        yourself]!<br/>
      </code>
      <code>
        transformedUsingBlock: aBlock<br/>
        ^(self class new: size)<br/>
        addAllQueensAt: (self queenPositions collect: aBlock)!<br/>
      </code>
      <code>
        unthreatenedSquaresInRow: anInteger<br/>
        | queenPositions |<br/>
        queenPositions := self queenPositions.<br/>
        ^((1 to: size) collect: [ :x | x@anInteger])<br/>
        select: [ :eachSquare | queenPositions<br/>
        allSatisfy: [ :eachQueen | (self queenAt: eachQueen threatens: eachSquare) not]]! !<br/>
      </code>
      <hr/>
      <p>
        Tests
      </p>
      <code>
        TestCase subclass: #EightTestCase<br/>
        instanceVariableNames: <em></em><br/>
        classVariableNames: <em></em><br/>
        poolDictionaries: <em>!</em><br/>
      </code>
      <code>
        !EightTestCase publicMethods !<br/>
      </code>
      <code>
        testAddQueen<br/>
        | board |<br/>
        board := Board new: 4.<br/>
        board addQueenAt: 1@2.<br/>
        self should: [ board printString = '1: |_|_|_|_|<br/>
      </code>
      <ol>
        <li>
          : |Q|_|_|_|
        </li>
        <li>
          : |_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|
        </li>
      </ol>
      <code>
        ']!<br/>
      </code>
      <code>
        testBoardDifferent<br/>
        | board1 board2 |<br/>
        board1 := Board new: 4.<br/>
        board1 addQueenAt: 1@2;<br/>
        addQueenAt: 2@1.<br/>
        board2 :=  Board new: 4.<br/>
        board2 addQueenAt: 1@1;<br/>
        addQueenAt: 1@2.<br/>
        self shouldnt: [ board1 = board2]!<br/>
      </code>
      <code>
        testBoardEquals<br/>
        | board1 board2 |<br/>
        board1 := Board new: 4.<br/>
        board1 addQueenAt: 1@2;<br/>
        addQueenAt: 2@1.<br/>
        board2 :=  Board new: 4.<br/>
        board2 addQueenAt: 2@1;<br/>
        addQueenAt: 1@2.<br/>
        self should: [ board1 = board2]!<br/>
      </code>
      <code>
        testNew1<br/>
        | board |<br/>
        board := Board new: 1.<br/>
        self should: [ board printString = '1: |_|<br/>
        ']!<br/>
      </code>
      <code>
        testNew4<br/>
        | board |<br/>
        board := Board new: 4.<br/>
        self should: [ board printString = '1: |_|_|_|_|<br/>
      </code>
      <ol>
        <li>
          : |_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|
        </li>
        <li>
          : |_|_|_|_|
        </li>
      </ol>
      <code>
        ']!<br/>
      </code>
      <code>
        testReflectionsAndRotations<br/>
        | board boardH boardV boardPd boardNd board90 board180 board270 rnr |<br/>
        board := (Board new: 4) addQueenAt: 1@2.<br/>
        rnr := board rotationsAndReflections.<br/>
        boardH := (Board new: 4) addQueenAt: 4@2.<br/>
        boardV := (Board new: 4) addQueenAt: 1@3.<br/>
        boardPd := (Board new: 4) addQueenAt: 2@1.<br/>
        boardNd := (Board new: 4) addQueenAt: 3@4.<br/>
        board90 := (Board new: 4) addQueenAt: 3@1.<br/>
        board180 := (Board new: 4) addQueenAt: 4@3.<br/>
        board270 := (Board new: 4) addQueenAt: 2@4.<br/>
        self should: [rnr includes: board].<br/>
        self should: [rnr includes: boardH].<br/>
        self should: [rnr includes: boardV].<br/>
        self should: [rnr includes: boardPd].<br/>
        self should: [rnr includes: boardNd].<br/>
        self should: [rnr includes: board90].<br/>
        self should: [rnr includes: board180].<br/>
        self should: [rnr includes: board270].!<br/>
      </code>
      <code>
        testSolutions1<br/>
        | board solutions solution1|<br/>
        board := Board new: 1.<br/>
        solution1 := Board new: 1.<br/>
        solution1 addQueenAt: 1@1.<br/>
        solutions := board solutions.<br/>
        self should: [solutions size = 1].<br/>
        self should: [solutions includes: solution1 ].!<br/>
      </code>
      <code>
        testSolutions4<br/>
        | board solutions solution1|<br/>
        board := Board new: 4.<br/>
        solution1 := Board new: 4.<br/>
        solution1<br/>
        addQueenAt: 1@3;<br/>
        addQueenAt: 2@1;<br/>
        addQueenAt: 3@4;<br/>
        addQueenAt: 4@2.<br/>
        solutions := board solutions.<br/>
        self should: [solutions size = 1].<br/>
        self should: [solutions includes: solution1 ].!<br/>
      </code>
      <code>
        testSolutions8<br/>
        | board solutions |<br/>
        board := Board new: 8.<br/>
        solutions := board solutions.<br/>
        self should: [solutions size = 12].! !<br/>
      </code>
    </div>
  </body>
</html>