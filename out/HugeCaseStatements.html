<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <base href="/mount/ultralaser_home/Projects/c2_wiki_recovery/out/">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div class="page">
      <h1>
        <img src="wiki.gif" />
        Huge Case Statements
      </h1>
      <p>
        i.e. (from a FooServletCommandFactory) This:
      </p>
      <code>
        if ( serviceName.equals( FooCommand.WENTRY_COMMAND ) )<br/>
        {<br/>
        newCommand = new WEntryCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WGET_ESENSE_PREFS_COMMAND ) )<br/>
        {<br/>
        newCommand = new WGetESensePrefsCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WREGISTER_COMMAND ) )<br/>
        {<br/>
        newCommand = new WRegisterCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WGET_MEMBER_INFO_COMMAND ) )<br/>
        {<br/>
        newCommand = new WGetMemberInfoCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WSET_MEMBER_INFO_COMMAND ) )<br/>
        {<br/>
        newCommand = new WSetMemberInfoCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WREP_RESET_PASSWORD_COMMAND ) )<br/>
        {<br/>
        newCommand = new WRepResetPasswordCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WPURCHASE_COMMAND ) )<br/>
        {<br/>
        newCommand = new WPurchaseCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WSERVER_EXIT_COMMAND ) )<br/>
        {<br/>
        newCommand = new WServerExitCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WCLIENT_EXIT_COMMAND ) )<br/>
        {<br/>
        newCommand = new WClientExitCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WGENERATE_EXIT_PAGE_COMMAND ) )<br/>
        {<br/>
        newCommand = new WGenerateExitPageCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WUPDATE_MEMBERSHIP_COMMAND ) )<br/>
        {<br/>
        newCommand = new WUpdateMembershipCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WNON_RENEW_MEMBERSHIP_COMMAND ) )<br/>
        {<br/>
        newCommand = new WNonRenewMembershipCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WCANCEL_MEMBERSHIP_COMMAND ) )<br/>
        {<br/>
        newCommand = new WCancelMembershipCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WDISPLAY_TRANSCRIPT_IDS_COMMAND ) )<br/>
        {<br/>
        newCommand = new WDisplayTranscriptIdsCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WDISPLAY_TRANSCRIPT_TEXT_COMMAND ) )<br/>
        {<br/>
        newCommand = new WDisplayTranscriptTextCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WAUTHENTICATE_MEMBER_COMMAND ) )<br/>
        {<br/>
        newCommand = new WAuthenticateMemberCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WCLIENT_ENTRY_INSTRUCTION_COMMAND ) )<br/>
        {    <br/>
        newCommand = new WClientEntryInstructionCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WCLIENT_ENTRY_CHAT_COMMAND ) )<br/>
        {<br/>
        newCommand = new WClientEntryChatCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WGET_ORDER_HISTORY_COMMAND ) )<br/>
        {<br/>
        newCommand = new WGetOrderHistoryCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WREP_INFO_COMMAND ) )<br/>
        {<br/>
        newCommand = new WRepSessionInfoCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WINSTANT_MEMBER_ENTRY_COMMAND ) )<br/>
        {<br/>
        newCommand = new WInstantMemberEntryCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WFREE_HELP_COMMAND ) )<br/>
        {<br/>
        newCommand = new WFreeHelpCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WCOOKIE_BASED_ENTRY_COMMAND ) )<br/>
        {<br/>
        newCommand = new WCookieBasedEntryCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( FooCommand.WREP_SESSION_INFO_COMMAND ) )<br/>
        {<br/>
        newCommand = new WRepSessionInfoCommand( servlet );<br/>
        }                        <br/>
        else if ( serviceName.equals( FooCommand.WCHAT_POPUP_COMMAND ) )<br/>
        {<br/>
        newCommand = new WChatPopupCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( "WGetURLCommand" ) )<br/>
        {<br/>
        newCommand = new WGetURLCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( "WLogCommand" ) )<br/>
        {<br/>
        newCommand = new WLogCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( "WClientQueueEntryCommand" ) )<br/>
        {<br/>
        newCommand = new WClientQueueEntryCommand( servlet );<br/>
        }<br/>
        else if ( serviceName.equals( "WGetInflatedTokensCommand" ) )<br/>
        {<br/>
        newCommand = new WGetInflatedTokensCommand( servlet );<br/>
        }       <br/>
        else<br/>
        {<br/>
        throw new RuntimeException("Unimplemented command: \"" + serviceName + "\"" );<br/>
        }<br/>
      </code>
      <code>
        newCommand.init( req );<br/>
      </code>
      <code>
        return newCommand;<br/>
      </code>
      <p>
        Turned into:
      </p>
      <code>
        /**<br/>
      </code>
      <ul>
        <li>
           Handle WGetRepInfoCommand separately, since it doesn't map from string to classname.
          <ul>
            <li>
              /
            </li>
          </ul>
        </li>
      </ul>
      <code>
        if ( serviceName.equals( FooCommand.WREP_INFO_COMMAND ) )<br/>
        {<br/>
        newCommand = new WRepSessionInfoCommand( servlet );<br/>
        }<br/>
        else<br/>
        {<br/>
        try<br/>
        {<br/>
        /**<br/>
      </code>
      <ul>
        <li>
           Create a class of the name (with the appropriate package name tacked on the front.
          <ul>
            <li>
              /
            </li>
          </ul>
        </li>
      </ul>
      <code>
        Class commandClass = Class.forName( "com.foo.servlet." + serviceName );<br/>
      </code>
      <code>
        /**<br/>
      </code>
      <ul>
        <li>
           This step is necessary because the FooCommands don't have a default constructor,
        </li>
        <li>
           so we have to get the appropriate constructor, and then call it's newInstance.
          <ul>
            <li>
              /
            </li>
          </ul>
        </li>
      </ul>
      <code>
        Constructor constructor = commandClass.getConstructor( new Class[]{ GenericServlet.class } );<br/>
        newCommand = (FooCommand) constructor.newInstance( new Object[]{ servlet } );<br/>
        }<br/>
        catch( Exception exception )<br/>
        {<br/>
        throw new RuntimeException("Unimplemented command: \"" + serviceName + "\"" );<br/>
        }<br/>
        }<br/>
      </code>
      <code>
        newCommand.init( req );<br/>
        return newCommand;<br/>
      </code>
      <p>
        Which is slower, but could be made just as fast with a Constructor-caching mechanism, and has the added benefit of not needing modification every time we want to add new commands.
        -- <a href="BlakeWinton.html">BlakeWinton</a>
      </p>
      <p>
        See also <a href="CollectionAndLoopVsSelectionIdiom.html">CollectionAndLoopVsSelectionIdiom</a>, <a href="PolymorphismVsSelectionIdiom.html">PolymorphismVsSelectionIdiom</a>
      </p>
      <p>
        This is an example of <a href="FactoryMap.html">FactoryMap</a> pattern. Normally, programmers have to register their classes with the factory, but in Java the class loader does it for you.
        -- <a href="HubertMatthews.html">HubertMatthews</a>
      </p>
      <p>
        <em>Don't try that on </em><a href="JavaCard.html">JavaCard</a>, though.<em></em>
      </p>
      <p>
        You could also try a factory map something like this:
      </p>
      <code>
        cmd = CommandManager.getInstance().createFrom( serviceName );<br/>
      </code>
      <code>
        ...<br/>
      </code>
      <code>
        interface CommandFactory<br/>
        {<br/>
        Command create();<br/>
        }<br/>
      </code>
      <code>
        ...<br/>
      </code>
      <code>
        // in some initializer<br/>
        CommandManager.getInstance().map(<br/>
        WREP_INFO_COMMAND,<br/>
        new CommandFactory() {<br/>
        public Command create() {<br/>
        return WRepSessionInfoCommand(); } } );<br/>
      </code>
      <code>
        public class CommandManager <br/>
        {<br/>
        private <a href="HashMap.html">HashMap</a> m_factoryMap = ...;<br/>
      </code>
      <code>
        public void map( Object key, CommandFactory creator )<br/>
        {<br/>
        m_factoryMap.put( key, creator );<br/>
        }<br/>
      </code>
      <code>
        public Command createFrom( Object key )<br/>
        {<br/>
        return (Command)((CommandCreator)m_factoryMap.get( key ));<br/>
        }<br/>
      </code>
      <code>
        ...<br/>
        }<br/>
      </code>
      <p>
        Or something like that. -- <a href="RobertDiFalco.html">RobertDiFalco</a>
      </p>
      <p>
        <em>The point (well, at least one point) of the above is that you have one and only one easy to change place where it's defined which commands exist - in this case, through the existence of a class in the com.foo.servlet package. When you put a mapping into the database, you duplicate that information. What's worse, you put that information into two different "media" (db and classes), where they can more easily get out of synch. For updating that table, you might have to fire up another tool. Plus, it's harder to implement, and would have to be changed for implementations without a database. You put application-specific information into the database, which might be used for several applications. Etc. etc. All in all, it seems like the worst solution by far to me. Sorry. -- </em><a href="FalkBruegmann.html">FalkBruegmann</a><em></em>
      </p>
      <hr/>
      <p>
        See NestedCaseStatements, <a href="SwitchStatementsSmell.html">SwitchStatementsSmell</a>
      </p>
      <hr/>
      <p>
        <a href="CategoryConditionalsAndDispatching.html">CategoryConditionalsAndDispatching</a>
      </p>
      <hr/>
      <p>
        <a href="CategoryJava.html">CategoryJava</a>
      </p>
    </div>
  </body>
</html>